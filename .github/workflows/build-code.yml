name: Build Code

on:
  workflow_call:
    inputs:
      image_name:
        description: 'Name of the Docker image'
        required: true
        type: string
        default: 'my-image'
      version_tag:
        description: 'Version tag for the image'
        required: true
        type: string
        default: 'latest'
        
jobs:
    build_code:
        runs-on: ubuntu-latest
        steps:
          - name: Download Docker image artifact
            uses: actions/download-artifact@v4
            with:
              name: ${{ inputs.image_name }}-${{ inputs.version_tag }}
              path: .

          - name: Load Docker image
            run: docker load -i ${{ inputs.image_name }}-${{ inputs.version_tag }}.tar

          - name: Checkout code
            uses: actions/checkout@v4

          - name: Build code inside Docker container
            run: |
              docker run --rm \
                -v "$PWD:/ros2_ws" \
                -w /ros2_ws \
                ${{ inputs.image_name }}-${{ inputs.version_tag }} \
                bash -c "echo 'Building code with image ${{ inputs.image_name }}-${{ inputs.version_tag }}'; # Your build commands here"
                ls -la /ros2_ws